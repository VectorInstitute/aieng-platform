{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"AI Engineering Platform","text":"<p>Infrastructure and tooling for AI Engineering bootcamps, providing secure, isolated development environments and automated participant onboarding.</p>"},{"location":"#overview","title":"Overview","text":"<p>This platform consists of the following components:</p> <ol> <li>Coder Deployment - Containerized development environments supported by Coder</li> <li>Participant Onboarding System - Secure, automated participant onboarding</li> </ol>"},{"location":"#1-coder-deployment-for-gcp","title":"1. Coder Deployment for GCP","text":"<p>The <code>coder</code> folder contains all resources needed to deploy a Coder instance on Google Cloud Platform (GCP), along with reusable workspace templates and Docker images for the workspace environment.</p>"},{"location":"#structure","title":"Structure","text":"<ul> <li>deploy/ - Terraform scripts and startup automation for provisioning the Coder server on a GCP VM</li> <li>docker/ - Dockerfiles and guides for building custom images used by Coder workspace templates</li> <li>templates/ - Coder workspace templates for reproducible, containerized development environments on GCP</li> </ul>"},{"location":"#usage","title":"Usage","text":"<ol> <li>Provision Coder on GCP - Follow the steps in <code>coder/deploy/README.md</code></li> <li>Build and Push Docker Images - See <code>coder/docker/README.md</code></li> <li>Push Workspace Templates - See <code>coder/templates/README.md</code></li> </ol>"},{"location":"#2-participant-onboarding-system","title":"2. Participant Onboarding System","text":"<p>Automated system for securely distributing team-specific API keys to bootcamp participants using Firebase Authentication and Firestore.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Secure Authentication - Firebase custom tokens with per-participant access</li> <li>Team Isolation - Firestore security rules enforce team-level data separation</li> <li>Automated Onboarding - One-command setup for participants</li> <li>API Key Management - Automated generation and distribution of API keys</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          Admin Phase                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. Setup teams and participants in Firestore                   \u2502\n\u2502  2. Generate team-specific API keys and shared keys             \u2502\n\u2502  3. Add users to github AI-Engineering-Platform org             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       Participant Phase                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  1. Run onboarding script in Coder workspace                    \u2502\n\u2502  2. Script authenticates using token server                     \u2502\n\u2502  3. Fetches team-specific API keys (security rules enforced)    \u2502\n\u2502  4. Creates .env file with all credentials                      \u2502\n\u2502  5. Runs integration tests to verify keys, marks onboard status \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"cli/","title":"CLI Reference","text":"<p>The <code>aieng-platform-onboard</code> package provides command-line tools for bootcamp participant onboarding, authentication, and administration.</p>"},{"location":"cli/#installation","title":"Installation","text":"<pre><code>pip install aieng-platform-onboard\n</code></pre>"},{"location":"cli/#overview","title":"Overview","text":"<p>The CLI provides two main commands:</p> <ul> <li><code>onboard</code> - Participant onboarding with team-specific API keys</li> <li><code>onboard admin</code> - Admin commands for managing participants and teams</li> </ul>"},{"location":"cli/#participant-onboarding","title":"Participant Onboarding","text":"<p>Main command for onboarding bootcamp participants with team-specific API keys.</p>"},{"location":"cli/#usage","title":"Usage","text":"<pre><code>onboard [OPTIONS]\n</code></pre>"},{"location":"cli/#options","title":"Options","text":""},{"location":"cli/#required","title":"Required","text":"Option Description Example <code>--bootcamp-name</code> Name of the bootcamp <code>--bootcamp-name fall-2025</code> <code>--test-script</code> Path to integration test script <code>--test-script tests/integration/test_api_keys.py</code>"},{"location":"cli/#optional","title":"Optional","text":"Option Description Default <code>--gcp-project</code> GCP project ID <code>coderd</code> <code>--output-dir</code> Directory for .env file <code>.</code> (current directory) <code>--firebase-api-key</code> Firebase Web API key for token exchange (from <code>FIREBASE_WEB_API_KEY</code> env var) <code>--skip-test</code> Skip integration tests <code>False</code> <code>--force</code> Force re-onboarding even if already onboarded <code>False</code> <code>--admin-status-report</code> Display onboarding status for all participants (admin only) <code>False</code> <code>--version</code> Show version number and exit -"},{"location":"cli/#onboarding-process","title":"Onboarding Process","text":"<p>The participant onboarding flow consists of 9 steps:</p> <ol> <li>Identify Participant - Detects GitHub username from environment</li> <li>Fetch Authentication Token - Retrieves fresh token from service</li> <li>Connect to Firestore - Initializes secure Firestore connection</li> <li>Fetch Your Profile - Reads participant data and team assignment</li> <li>Fetch Team API Keys - Retrieves team-specific API keys</li> <li>Fetch Global Configuration - Fetches shared configuration keys</li> <li>Create Environment File - Generates .env file with all keys</li> <li>Run Integration Test - Validates API keys (optional)</li> <li>Mark as Onboarded - Updates participant status in Firestore</li> </ol>"},{"location":"cli/#examples","title":"Examples","text":"<p>Basic Onboarding: <pre><code>export GITHUB_USER=myusername\nonboard \\\n  --bootcamp-name fall-2025 \\\n  --test-script tests/integration/test_api_keys.py\n</code></pre></p> <p>Skip Integration Tests: <pre><code>onboard \\\n  --bootcamp-name fall-2025 \\\n  --test-script tests/integration/test_api_keys.py \\\n  --skip-test\n</code></pre></p> <p>Force Re-onboarding: <pre><code>onboard \\\n  --bootcamp-name fall-2025 \\\n  --test-script tests/integration/test_api_keys.py \\\n  --force\n</code></pre></p> <p>Custom Output Directory: <pre><code>onboard \\\n  --bootcamp-name fall-2025 \\\n  --test-script tests/integration/test_api_keys.py \\\n  --output-dir ~/my-bootcamp\n</code></pre></p> <p>Admin Status Report: <pre><code># Requires admin credentials\ngcloud auth application-default login\nonboard --admin-status-report --gcp-project coderd\n</code></pre></p>"},{"location":"cli/#admin-commands","title":"Admin Commands","text":"<p>Admin commands for managing bootcamp participants and teams in Firestore.</p>"},{"location":"cli/#onboard-admin-setup-participants","title":"<code>onboard admin setup-participants</code>","text":"<p>Setup participants and teams from a CSV file. This command creates both team documents and participant documents in Firestore.</p>"},{"location":"cli/#usage_1","title":"Usage","text":"<pre><code>onboard admin setup-participants &lt;csv_file&gt; [OPTIONS]\n</code></pre>"},{"location":"cli/#arguments","title":"Arguments","text":"Argument Description Required <code>csv_file</code> Path to CSV file Yes"},{"location":"cli/#csv-format","title":"CSV Format","text":"<p>Required columns: - <code>github_handle</code> - GitHub username - <code>team_name</code> - Team name</p> <p>Optional columns: - <code>email</code> - Email address - <code>first_name</code> - First name - <code>last_name</code> - Last name</p> <p>Sample CSV: <pre><code>github_handle,team_name,email,first_name,last_name\nalice,team-alpha,alice@example.com,Alice,Smith\nbob,team-alpha,bob@example.com,Bob,Jones\ncharlie,team-beta,charlie@example.com,Charlie,Brown\n</code></pre></p>"},{"location":"cli/#options_1","title":"Options","text":"Option Description <code>--dry-run</code> Validate and preview changes without modifying Firestore"},{"location":"cli/#examples_1","title":"Examples","text":"<p>Setup participants from CSV: <pre><code>onboard admin setup-participants config/participants.csv\n</code></pre></p> <p>Dry run (validate only): <pre><code>onboard admin setup-participants config/participants.csv --dry-run\n</code></pre></p>"},{"location":"cli/#requirements","title":"Requirements","text":"<ul> <li>Admin credentials (service account or gcloud auth)</li> <li>Firestore write access</li> </ul>"},{"location":"cli/#onboard-admin-delete-participants","title":"<code>onboard admin delete-participants</code>","text":"<p>Delete participants from Firestore database. Can optionally remove empty teams after participant deletion.</p>"},{"location":"cli/#usage_2","title":"Usage","text":"<pre><code>onboard admin delete-participants &lt;csv_file&gt; [OPTIONS]\n</code></pre>"},{"location":"cli/#arguments_1","title":"Arguments","text":"Argument Description Required <code>csv_file</code> Path to CSV file with participants to delete Yes"},{"location":"cli/#csv-format_1","title":"CSV Format","text":"<p>Required columns: - <code>github_handle</code> - GitHub username of participant to delete</p> <p>Sample CSV: <pre><code>github_handle\nalice\nbob\n</code></pre></p>"},{"location":"cli/#options_2","title":"Options","text":"Option Description Default <code>--dry-run</code> Validate and preview changes without modifying Firestore <code>False</code> <code>--keep-empty-teams</code> Keep teams even if they become empty after removing participants <code>False</code>"},{"location":"cli/#examples_2","title":"Examples","text":"<p>Delete participants from CSV: <pre><code>onboard admin delete-participants config/to_remove.csv\n</code></pre></p> <p>Dry run (preview only): <pre><code>onboard admin delete-participants config/to_remove.csv --dry-run\n</code></pre></p> <p>Delete participants but keep empty teams: <pre><code>onboard admin delete-participants config/to_remove.csv --keep-empty-teams\n</code></pre></p>"},{"location":"cli/#requirements_1","title":"Requirements","text":"<ul> <li>Admin credentials (service account or gcloud auth)</li> <li>Firestore write access</li> </ul>"},{"location":"cli/#environment-variables","title":"Environment Variables","text":"Variable Description Required <code>GITHUB_USER</code> GitHub username for authentication Yes (for participant onboarding) <code>FIREBASE_WEB_API_KEY</code> Firebase Web API key (can be passed via <code>--firebase-api-key</code>) Yes (for participant onboarding) <code>GOOGLE_APPLICATION_CREDENTIALS</code> Path to GCP service account key Yes (for admin commands)"},{"location":"cli/#exit-codes","title":"Exit Codes","text":"Code Description <code>0</code> Success <code>1</code> Failure (authentication, connection, or configuration error)"},{"location":"cli/#generated-files","title":"Generated Files","text":""},{"location":"cli/#env-file","title":".env File","text":"<p>The onboarding process creates a <code>.env</code> file containing:</p> <ul> <li>Team-specific API keys (OpenAI/Gemini, Langfuse)</li> <li>Global shared configuration</li> <li>Bootcamp-specific settings</li> </ul> <p>Location: Specified by <code>--output-dir</code> (default: current directory)</p> <p>Usage: <pre><code>source .env\n</code></pre></p>"},{"location":"cli/#troubleshooting","title":"Troubleshooting","text":""},{"location":"cli/#authentication-failures","title":"Authentication Failures","text":"<ul> <li>Ensure <code>GITHUB_USER</code> environment variable is set</li> <li>Verify you're added to the participant list (contact admin)</li> <li>Check token service is deployed and accessible</li> </ul>"},{"location":"cli/#connection-failures","title":"Connection Failures","text":"<ul> <li>Verify GCP project ID is correct</li> <li>Check Firebase Web API key is valid</li> <li>Ensure Firestore security rules allow participant access</li> </ul>"},{"location":"cli/#integration-test-failures","title":"Integration Test Failures","text":"<ul> <li>Check that .env file was created successfully</li> <li>Verify API keys are valid (contact admin if needed)</li> <li>Use <code>--skip-test</code> to bypass tests if keys need manual verification</li> </ul>"},{"location":"cli/#admin-command-failures","title":"Admin Command Failures","text":"<ul> <li>Ensure you're authenticated with proper GCP permissions:   <pre><code>gcloud auth application-default login\n</code></pre></li> <li>Or set <code>GOOGLE_APPLICATION_CREDENTIALS</code> to service account key path</li> <li>Verify you have Firestore read/write access for the project</li> </ul>"},{"location":"cli/#csv-validation-errors","title":"CSV Validation Errors","text":"<ul> <li>Check CSV has required columns: <code>github_handle</code>, <code>team_name</code> (for setup-participants)</li> <li>Check CSV has required column: <code>github_handle</code> (for delete-participants)</li> <li>Verify GitHub handles are valid (alphanumeric and hyphens, max 39 chars)</li> <li>Ensure team names are valid (alphanumeric, hyphens, underscores)</li> <li>Check for duplicate GitHub handles in CSV</li> </ul>"},{"location":"developer_guide/","title":"Developer Guide","text":"<p>This guide provides comprehensive information for developers and administrators working with the AI Engineering Platform infrastructure.</p>"},{"location":"developer_guide/#overview","title":"Overview","text":"<p>The AI Engineering Platform consists of multiple components that work together to provide secure, isolated development environments and automated participant management. This guide covers deployment, configuration, and maintenance procedures.</p>"},{"location":"developer_guide/#platform-components","title":"Platform Components","text":""},{"location":"developer_guide/#1-coder-server","title":"1. Coder Server","text":"<ul> <li>Purpose: Provides containerized development environments</li> <li>Deployment: GCP VM with Terraform</li> <li>Documentation: See Coder Deployment</li> </ul>"},{"location":"developer_guide/#2-participant-onboarding-system","title":"2. Participant Onboarding System","text":"<ul> <li>Purpose: Automated participant authentication and API key distribution</li> <li>Components: Firebase Authentication, Firestore, Cloud Functions</li> <li>Documentation: See Participant Onboarding</li> </ul>"},{"location":"developer_guide/#3-onboarding-status-dashboard","title":"3. Onboarding Status Dashboard","text":"<ul> <li>Purpose: Real-time monitoring of participant onboarding status</li> <li>Deployment: Next.js on Cloud Run with Load Balancer path-based routing</li> <li>Access: <code>https://platform.vectorinstitute.ai/onboarding</code></li> </ul>"},{"location":"developer_guide/#infrastructure-deployment","title":"Infrastructure Deployment","text":""},{"location":"developer_guide/#coder-server-deployment","title":"Coder Server Deployment","text":"<p>Follow the comprehensive deployment guide in the <code>coder/deploy/</code> directory.</p> <p>Quick Start: <pre><code>cd coder/deploy\nterraform init\nterraform plan\nterraform apply\n</code></pre></p> <p>For detailed instructions, see <code>coder/deploy/README.md</code>.</p>"},{"location":"developer_guide/#onboarding-status-web-dashboard","title":"Onboarding Status Web Dashboard","text":"<p>The onboarding status dashboard is deployed on Cloud Run and integrated with the main platform load balancer using path-based routing.</p> <p>Setup Guide: Onboarding Status Web - Load Balancer Setup</p> <p>This guide covers:</p> <ul> <li>Configuring Next.js with basePath for path-based routing</li> <li>Creating serverless Network Endpoint Groups (NEG)</li> <li>Setting up backend services for Cloud Run</li> <li>Configuring load balancer path matchers</li> <li>Deployment and verification procedures</li> <li>Troubleshooting common issues</li> </ul> <p>Automated Deployment (Recommended):</p> <p>The service is automatically deployed via GitHub Actions when changes are pushed to the <code>main</code> branch. The workflow: - Builds and tests the Docker container - Pushes to Google Artifact Registry - Deploys to Cloud Run - Verifies health checks</p> <p>Manual Deployment: <pre><code>./scripts/admin/deploy_onboarding_status_web.sh\n</code></pre></p> <p>Access URL: <pre><code>https://platform.vectorinstitute.ai/onboarding\n</code></pre></p> <p>Required GitHub Secrets for Automated Deployment:</p> <p>Configure these secrets in GitHub repository settings (<code>Settings</code> \u2192 <code>Secrets and variables</code> \u2192 <code>Actions</code>):</p> <ol> <li>GCP_PROJECT_ID: Your GCP project ID (e.g., <code>coderd</code>)</li> <li>WIF_PROVIDER: Workload Identity Federation provider</li> <li>Format: <code>projects/PROJECT_NUMBER/locations/global/workloadIdentityPools/POOL_ID/providers/PROVIDER_ID</code></li> <li>GCP_SERVICE_ACCOUNT: Service account email for deployment</li> <li>Format: <code>SERVICE_ACCOUNT_NAME@PROJECT_ID.iam.gserviceaccount.com</code></li> <li>Required roles: <code>roles/run.admin</code>, <code>roles/iam.serviceAccountUser</code>, <code>roles/artifactregistry.admin</code></li> <li>GH_ORG_TOKEN: Personal access token with <code>read:org</code> scope for checking GitHub organization membership</li> </ol>"},{"location":"developer_guide/#service-architecture","title":"Service Architecture","text":""},{"location":"developer_guide/#load-balancer-configuration","title":"Load Balancer Configuration","text":"<p>The platform uses a single Google Cloud Load Balancer to route traffic to multiple backend services:</p> <pre><code>platform.vectorinstitute.ai/\n\u251c\u2500\u2500 /                    \u2192 Coder Server (VM: coder-entrypoint)\n\u251c\u2500\u2500 /onboarding          \u2192 Cloud Run (onboarding-status-web)\n\u2514\u2500\u2500 /onboarding/*        \u2192 Cloud Run (onboarding-status-web)\n</code></pre> <p>Key Resources:</p> Resource Name Purpose External IP <code>coderd-https-lb-ip</code> Static IP for load balancer HTTPS Forwarding Rule <code>coderd-https-forwarding-rule</code> Routes HTTPS traffic HTTPS Proxy <code>coderd-https-proxy</code> SSL termination URL Map <code>https-url-map</code> Path-based routing configuration Backend Service (Coder) <code>coderd-backend</code> Routes to Coder VM Backend Service (Onboarding) <code>onboarding-backend</code> Routes to Cloud Run"},{"location":"developer_guide/#firebase-services","title":"Firebase Services","text":"<p>The platform uses Firebase for authentication and data storage:</p> <ul> <li>Firebase Authentication: Custom token generation for participants</li> <li>Firestore: Participant data, team assignments, and API keys</li> <li>Firebase Security Rules: Enforce team-level data isolation</li> </ul>"},{"location":"developer_guide/#administration","title":"Administration","text":""},{"location":"developer_guide/#participant-management","title":"Participant Management","text":""},{"location":"developer_guide/#adding-participants","title":"Adding Participants","text":"<p>Use the admin scripts to add new participants:</p> <pre><code>python scripts/admin/setup_participants.py\n</code></pre> <p>Requirements: - CSV file with participant information - Firebase admin credentials - Team assignments</p>"},{"location":"developer_guide/#viewing-onboarding-status","title":"Viewing Onboarding Status","text":"<p>Command Line: <pre><code>onboard --admin-status-report --gcp-project coderd\n</code></pre></p> <p>Web Dashboard: <pre><code>https://platform.vectorinstitute.ai/onboarding\n</code></pre></p> <p>The dashboard provides: - Real-time participant status - Onboarding completion rates - Filtering by status - CSV export functionality</p>"},{"location":"developer_guide/#monitoring-and-maintenance","title":"Monitoring and Maintenance","text":""},{"location":"developer_guide/#health-checks","title":"Health Checks","text":"<p>Coder Server: <pre><code>curl -I https://platform.vectorinstitute.ai/\n</code></pre></p> <p>Onboarding Dashboard: <pre><code>curl -I https://platform.vectorinstitute.ai/onboarding\n</code></pre></p> <p>Onboarding API: <pre><code>curl https://platform.vectorinstitute.ai/onboarding/api/participants\n</code></pre></p>"},{"location":"developer_guide/#log-access","title":"Log Access","text":"<p>Cloud Run Logs: <pre><code>gcloud logging read \"resource.type=cloud_run_revision AND resource.labels.service_name=onboarding-status-web\" \\\n  --project=coderd \\\n  --limit=50 \\\n  --format=json\n</code></pre></p> <p>Coder Server Logs: <pre><code># SSH into VM\ngcloud compute ssh coder-entrypoint --project=coderd --zone=us-central1-a\n\n# View logs\nsudo journalctl -u coder -f\n</code></pre></p>"},{"location":"developer_guide/#resource-management","title":"Resource Management","text":"<p>List Active Services: <pre><code># Cloud Run services\ngcloud run services list --project=coderd\n\n# Compute instances\ngcloud compute instances list --project=coderd\n\n# Backend services\ngcloud compute backend-services list --project=coderd\n</code></pre></p>"},{"location":"onboarding-status-web-auth/","title":"Onboarding Status Web Authentication","text":""},{"location":"onboarding-status-web-auth/#overview","title":"Overview","text":"<p>The Onboarding Status Web dashboard uses Google OAuth 2.0 with server-side sessions for authentication. Only @vectorinstitute.ai email addresses can access the dashboard.</p>"},{"location":"onboarding-status-web-auth/#architecture","title":"Architecture","text":"<ul> <li>Library: <code>@vector-institute/aieng-auth-core</code></li> <li>Session Management: <code>iron-session</code> with encrypted HTTP-only cookies</li> <li>Security: PKCE flow, domain restriction, encrypted sessions</li> <li>Path: All routes under <code>/onboarding</code> base path</li> </ul>"},{"location":"onboarding-status-web-auth/#authentication-flow","title":"Authentication Flow","text":"<ol> <li>User visits <code>/onboarding</code> \u2192 redirected to <code>/onboarding/login</code> if not authenticated</li> <li>Click \"Sign in with Google\" \u2192 <code>/onboarding/api/auth/login</code></li> <li>Google OAuth flow with PKCE</li> <li>Callback to <code>/onboarding/api/auth/callback</code></li> <li>Session created, user redirected to dashboard</li> </ol>"},{"location":"onboarding-status-web-auth/#files","title":"Files","text":""},{"location":"onboarding-status-web-auth/#configuration","title":"Configuration","text":"<ul> <li><code>lib/auth-config.ts</code> - OAuth config</li> <li><code>lib/session.ts</code> - Session management</li> </ul>"},{"location":"onboarding-status-web-auth/#api-routes","title":"API Routes","text":"<ul> <li><code>app/api/auth/login/route.ts</code> - Initiate OAuth</li> <li><code>app/api/auth/callback/route.ts</code> - Handle callback</li> <li><code>app/api/auth/logout/route.ts</code> - Destroy session</li> <li><code>app/api/auth/session/route.ts</code> - Get session info</li> </ul>"},{"location":"onboarding-status-web-auth/#pages","title":"Pages","text":"<ul> <li><code>app/page.tsx</code> - Protected dashboard</li> <li><code>app/login/page.tsx</code> - Login page</li> <li><code>app/dashboard-content.tsx</code> - Dashboard UI</li> </ul>"},{"location":"onboarding-status-web-auth/#environment-variables","title":"Environment Variables","text":"<pre><code># OAuth\nNEXT_PUBLIC_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com\nGOOGLE_CLIENT_SECRET=GOCSPX-your-secret\nSESSION_SECRET=generate-with-openssl-rand-base64-32\n\n# URLs\nNEXT_PUBLIC_APP_URL=http://localhost:3000\nREDIRECT_URI=http://localhost:3000/onboarding/api/auth/callback\n\n# Domain restriction\nALLOWED_DOMAINS=vectorinstitute.ai\n</code></pre>"},{"location":"onboarding-status-web-auth/#local-development","title":"Local Development","text":"<ol> <li>Copy OAuth credentials from <code>aieng-template-auth/apps/demo-nextjs/.env</code></li> <li>Update redirect URI in <code>.env</code>: <code>http://localhost:3000/onboarding/api/auth/callback</code></li> <li>Run <code>npm run dev</code></li> <li>Visit <code>http://localhost:3000/onboarding</code></li> <li>Sign in with @vectorinstitute.ai account</li> </ol>"},{"location":"onboarding-status-web-auth/#production-deployment","title":"Production Deployment","text":""},{"location":"onboarding-status-web-auth/#required-github-secrets","title":"Required GitHub Secrets","text":"<ul> <li><code>GOOGLE_CLIENT_ID</code> - Shared Vector OAuth client ID</li> <li><code>GOOGLE_CLIENT_SECRET</code> - OAuth client secret</li> <li><code>SESSION_SECRET</code> - Generated with <code>openssl rand -base64 32</code></li> <li><code>APP_URL</code> - Production URL (e.g., <code>https://your-service.run.app</code>)</li> <li><code>REDIRECT_URI</code> - Production callback URL (e.g., <code>https://your-service.run.app/onboarding/api/auth/callback</code>)</li> </ul>"},{"location":"onboarding-status-web-auth/#setup-steps","title":"Setup Steps","text":"<ol> <li>Get shared OAuth client ID from admin</li> <li>Ask admin to add production redirect URI to Google OAuth client</li> <li>Set GitHub secrets in repository settings</li> <li>Deploy via GitHub Actions workflow</li> </ol>"},{"location":"onboarding-status-web-auth/#troubleshooting","title":"Troubleshooting","text":"<p>\"Invalid redirect_uri\" - Verify redirect URI registered in Google Cloud Console - Check <code>REDIRECT_URI</code> matches registered value</p> <p>\"Unauthorized domain\" - User must have @vectorinstitute.ai email - Check <code>ALLOWED_DOMAINS</code> environment variable</p> <p>Session issues - Verify <code>SESSION_SECRET</code> is at least 32 characters - Clear browser cookies</p>"},{"location":"onboarding-status-web-auth/#dependencies","title":"Dependencies","text":"<pre><code>{\n  \"@vector-institute/aieng-auth-core\": \"^0.1.x\",\n  \"iron-session\": \"^8.0.1\"\n}\n</code></pre>"},{"location":"onboarding-status-web-load-balancer-setup/","title":"Onboarding Status Web - Load Balancer Path-Based Routing Setup","text":"<p>This document provides step-by-step instructions for configuring path-based routing to serve the Onboarding Status Web dashboard at <code>https://platform.vectorinstitute.ai/onboarding</code> using Google Cloud Load Balancer.</p>"},{"location":"onboarding-status-web-load-balancer-setup/#overview","title":"Overview","text":"<p>The setup routes traffic from <code>platform.vectorinstitute.ai/onboarding</code> to a Cloud Run service while keeping all other traffic (including the root path) routed to the Coder server VM.</p> <p>Architecture: - <code>platform.vectorinstitute.ai/</code> \u2192 Coder Server (VM: <code>coder-entrypoint</code>) - <code>platform.vectorinstitute.ai/onboarding</code> \u2192 Cloud Run (<code>onboarding-status-web</code>)</p>"},{"location":"onboarding-status-web-load-balancer-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>GCP project: <code>coderd</code></li> <li>Existing load balancer with:</li> <li>External IP: <code>coderd-https-lb-ip</code></li> <li>HTTPS forwarding rule: <code>coderd-https-forwarding-rule</code></li> <li>HTTPS proxy: <code>coderd-https-proxy</code></li> <li>URL map: <code>https-url-map</code></li> <li>Backend service: <code>coderd-backend</code> (pointing to Coder VM)</li> <li>Cloud Run service: <code>onboarding-status-web</code> already deployed</li> </ul>"},{"location":"onboarding-status-web-load-balancer-setup/#step-1-configure-nextjs-base-path","title":"Step 1: Configure Next.js Base Path","text":"<p>Update the Next.js configuration to serve the app under the <code>/onboarding</code> path.</p> <p>File: <code>services/onboarding-status-web/next.config.js</code></p> <pre><code>/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  basePath: '/onboarding',\n  output: 'standalone',\n  eslint: {\n    ignoreDuringBuilds: true,\n  },\n  typescript: {\n    ignoreBuildErrors: false,\n  },\n}\n\nmodule.exports = nextConfig\n</code></pre> <p>Important: Update the API fetch path in the client code to use the absolute path:</p> <p>File: <code>services/onboarding-status-web/app/page.tsx</code></p> <p>Change: <pre><code>const response = await fetch('/api/participants', {\n</code></pre></p> <p>To: <pre><code>const response = await fetch('/onboarding/api/participants', {\n</code></pre></p>"},{"location":"onboarding-status-web-load-balancer-setup/#step-2-create-serverless-network-endpoint-group-neg","title":"Step 2: Create Serverless Network Endpoint Group (NEG)","text":"<p>Create a serverless NEG that points to the Cloud Run service.</p> <pre><code>gcloud compute network-endpoint-groups create onboarding-status-neg \\\n  --project=coderd \\\n  --region=us-central1 \\\n  --network-endpoint-type=serverless \\\n  --cloud-run-service=onboarding-status-web\n</code></pre> <p>Verification: <pre><code>gcloud compute network-endpoint-groups describe onboarding-status-neg \\\n  --project=coderd \\\n  --region=us-central1\n</code></pre></p>"},{"location":"onboarding-status-web-load-balancer-setup/#step-3-create-backend-service","title":"Step 3: Create Backend Service","text":"<p>Create a backend service for the onboarding dashboard.</p> <pre><code>gcloud compute backend-services create onboarding-backend \\\n  --project=coderd \\\n  --global \\\n  --load-balancing-scheme=EXTERNAL_MANAGED\n</code></pre> <p>Verification: <pre><code>gcloud compute backend-services describe onboarding-backend \\\n  --project=coderd \\\n  --global\n</code></pre></p>"},{"location":"onboarding-status-web-load-balancer-setup/#step-4-add-neg-to-backend-service","title":"Step 4: Add NEG to Backend Service","text":"<p>Connect the serverless NEG to the backend service.</p> <pre><code>gcloud compute backend-services add-backend onboarding-backend \\\n  --project=coderd \\\n  --global \\\n  --network-endpoint-group=onboarding-status-neg \\\n  --network-endpoint-group-region=us-central1\n</code></pre> <p>Verification: <pre><code>gcloud compute backend-services describe onboarding-backend \\\n  --project=coderd \\\n  --global \\\n  --format=\"yaml(name,backends)\"\n</code></pre></p>"},{"location":"onboarding-status-web-load-balancer-setup/#step-5-backup-current-url-map","title":"Step 5: Backup Current URL Map","text":"<p>Before making changes, backup the existing URL map configuration.</p> <pre><code>gcloud compute url-maps export https-url-map \\\n  --project=coderd \\\n  --destination=url-map-backup-$(date +%Y%m%d).yaml\n</code></pre>"},{"location":"onboarding-status-web-load-balancer-setup/#step-6-update-url-map-with-path-based-routing","title":"Step 6: Update URL Map with Path-Based Routing","text":"<p>Add path matcher rules to route <code>/onboarding</code> traffic to the Cloud Run backend.</p> <pre><code>gcloud compute url-maps add-path-matcher https-url-map \\\n  --project=coderd \\\n  --path-matcher-name=onboarding-matcher \\\n  --default-service=coderd-backend \\\n  --path-rules=\"/onboarding=onboarding-backend,/onboarding/*=onboarding-backend\"\n</code></pre> <p>Verification: <pre><code>gcloud compute url-maps describe https-url-map \\\n  --project=coderd\n</code></pre></p> <p>Expected output should show: <pre><code>defaultService: .../coderd-backend\nhostRules:\n- hosts:\n  - '*'\n  pathMatcher: onboarding-matcher\npathMatchers:\n- defaultService: .../coderd-backend\n  name: onboarding-matcher\n  pathRules:\n  - paths:\n    - /onboarding\n    - /onboarding/*\n    service: .../onboarding-backend\n</code></pre></p>"},{"location":"onboarding-status-web-load-balancer-setup/#step-7-deploy-updated-nextjs-application","title":"Step 7: Deploy Updated Next.js Application","text":"<p>Deploy the updated application with the basePath configuration.</p> <pre><code>./scripts/admin/deploy_onboarding_status_web.sh\n</code></pre>"},{"location":"onboarding-status-web-load-balancer-setup/#step-8-verify-and-test","title":"Step 8: Verify and Test","text":"<p>Wait 5-10 minutes for the load balancer configuration to propagate across Google's network.</p>"},{"location":"onboarding-status-web-load-balancer-setup/#test-coder-platform-unchanged","title":"Test Coder Platform (unchanged)","text":"<p><pre><code>curl -I https://platform.vectorinstitute.ai/\n</code></pre> Expected: HTTP 200 with Coder server headers</p>"},{"location":"onboarding-status-web-load-balancer-setup/#test-onboarding-dashboard","title":"Test Onboarding Dashboard","text":"<p><pre><code>curl -I https://platform.vectorinstitute.ai/onboarding\n</code></pre> Expected: HTTP 200 with Next.js headers</p>"},{"location":"onboarding-status-web-load-balancer-setup/#test-onboarding-api","title":"Test Onboarding API","text":"<p><pre><code>curl -s https://platform.vectorinstitute.ai/onboarding/api/participants | jq '.summary'\n</code></pre> Expected: JSON response with participant summary</p>"},{"location":"onboarding-status-web-load-balancer-setup/#browser-test","title":"Browser Test","text":"<p>Open <code>https://platform.vectorinstitute.ai/onboarding</code> in a browser. You should see: - Dashboard loads without errors - Participant data appears in the table - No JSON parsing errors in browser console</p>"},{"location":"onboarding-status-web-load-balancer-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"onboarding-status-web-load-balancer-setup/#issue-404-on-cloud-run-direct-url","title":"Issue: 404 on Cloud Run Direct URL","text":"<p>Symptom: <code>https://onboarding-status-web-736624225747.us-central1.run.app/</code> returns 404</p> <p>Status: This is expected behavior! The app is configured with <code>basePath: '/onboarding'</code>, so: - \u274c <code>https://[cloud-run-url]/</code> \u2192 404 (no root route) - \u2705 <code>https://[cloud-run-url]/onboarding</code> \u2192 Works - \u2705 <code>https://platform.vectorinstitute.ai/onboarding</code> \u2192 Works (intended access)</p> <p>Users should always access via the load balancer URL, not the direct Cloud Run URL.</p>"},{"location":"onboarding-status-web-load-balancer-setup/#issue-api-returns-html-instead-of-json","title":"Issue: API Returns HTML Instead of JSON","text":"<p>Symptom: Browser console shows <code>Unexpected token '&lt;', \"&lt;!doctype \"... is not valid JSON</code></p> <p>Cause: The fetch is going to the wrong endpoint (hitting Coder server instead of Cloud Run)</p> <p>Solution: Ensure the fetch uses the absolute path <code>/onboarding/api/participants</code> in <code>app/page.tsx</code></p>"},{"location":"onboarding-status-web-load-balancer-setup/#issue-changes-not-taking-effect","title":"Issue: Changes Not Taking Effect","text":"<p>Cause: Browser cache or load balancer propagation delay</p> <p>Solution: 1. Wait 5-10 minutes for load balancer changes to propagate 2. Hard refresh browser (Ctrl+Shift+R or Cmd+Shift+R) 3. Clear browser cache</p>"},{"location":"onboarding-status-web-load-balancer-setup/#rollback-procedure","title":"Rollback Procedure","text":"<p>If you need to rollback the URL map changes:</p> <pre><code># Remove the path matcher\ngcloud compute url-maps remove-path-matcher https-url-map \\\n  --project=coderd \\\n  --path-matcher-name=onboarding-matcher\n\n# Or restore from backup\ngcloud compute url-maps import https-url-map \\\n  --project=coderd \\\n  --source=url-map-backup-YYYYMMDD.yaml \\\n  --global\n</code></pre>"},{"location":"onboarding-status-web-load-balancer-setup/#resources-created","title":"Resources Created","text":"<p>This setup creates the following GCP resources:</p> Resource Type Name Purpose Network Endpoint Group <code>onboarding-status-neg</code> Connects load balancer to Cloud Run service Backend Service <code>onboarding-backend</code> Backend for onboarding dashboard traffic URL Map Path Rules <code>/onboarding</code>, <code>/onboarding/*</code> Routes specific paths to Cloud Run"},{"location":"onboarding-status-web-load-balancer-setup/#maintenance","title":"Maintenance","text":""},{"location":"onboarding-status-web-load-balancer-setup/#redeploying-the-application","title":"Redeploying the Application","text":"<p>To redeploy with code changes:</p> <pre><code># Make your code changes, then deploy\n./scripts/admin/deploy_onboarding_status_web.sh\n</code></pre> <p>The load balancer configuration remains intact and doesn't need to be reconfigured.</p>"},{"location":"onboarding-status-web-load-balancer-setup/#updating-load-balancer-configuration","title":"Updating Load Balancer Configuration","text":"<p>If you need to modify the path rules:</p> <pre><code># Export current config\ngcloud compute url-maps export https-url-map \\\n  --project=coderd \\\n  --destination=url-map-current.yaml\n\n# Edit url-map-current.yaml, then import\ngcloud compute url-maps import https-url-map \\\n  --project=coderd \\\n  --source=url-map-current.yaml \\\n  --global\n</code></pre>"},{"location":"onboarding-status-web-load-balancer-setup/#checking-resource-status","title":"Checking Resource Status","text":"<pre><code># List all backend services\ngcloud compute backend-services list --project=coderd\n\n# List all NEGs\ngcloud compute network-endpoint-groups list --project=coderd\n\n# View URL map configuration\ngcloud compute url-maps describe https-url-map --project=coderd\n</code></pre>"},{"location":"onboarding-status-web-load-balancer-setup/#notes","title":"Notes","text":"<ul> <li>No Downtime: The load balancer update is non-disruptive. Existing traffic continues to flow during configuration changes.</li> <li>Default Behavior: All traffic not matching <code>/onboarding</code> or <code>/onboarding/*</code> continues to route to the Coder server.</li> <li>SSL Certificate: The existing SSL certificate (<code>myservice-ssl-cert</code>) covers <code>platform.vectorinstitute.ai</code> and is used for both the Coder server and the onboarding dashboard.</li> <li>Propagation Time: Load balancer configuration changes take 5-10 minutes to propagate globally.</li> </ul>"},{"location":"onboarding-status-web-load-balancer-setup/#reference","title":"Reference","text":"<ul> <li>Cloud Run Serverless NEGs</li> <li>URL Map Path Rules</li> <li>Next.js basePath</li> </ul>"}]}